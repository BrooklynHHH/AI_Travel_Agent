# æµå¼æ•°æ®æµ‹è¯•å·¥å…·ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`test_stream_data_logger.py` æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•å’Œåˆ†æ `run_enhanced_streaming_api` å‡½æ•°åŸå§‹æ•°æ®è¾“å‡ºçš„å·¥å…·ã€‚å®ƒèƒ½å¤Ÿè¯¦ç»†è®°å½•æµå¼æ•°æ®çš„ç»“æ„ã€æ€§èƒ½æŒ‡æ ‡å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œä¸ºåæœŸAPIå°è£…æä¾›æ•°æ®åŸºç¡€ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ•°æ®æ•è·
- **åŸå§‹æ•°æ®è®°å½•**ï¼šå®Œæ•´ä¿å­˜æ¯ä¸ªæ•°æ®å—çš„JSONæ ¼å¼
- **å®æ—¶ç›‘æ§**ï¼šæ˜¾ç¤ºæ•°æ®å—å¤„ç†è¿›åº¦å’ŒåŸºæœ¬ä¿¡æ¯
- **é”™è¯¯å¤„ç†**ï¼šæ•è·å¹¶è®°å½•å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸

### ğŸ“Š æ•°æ®åˆ†æ
- **ç»“æ„åˆ†æ**ï¼šé€’å½’åˆ†ææ•°æ®å­—æ®µå’Œç±»å‹ç»“æ„
- **ç»Ÿè®¡ä¿¡æ¯**ï¼šè®°å½•å­—æ®µå‡ºç°é¢‘ç‡å’Œæ•°æ®ç±»å‹åˆ†å¸ƒ
- **æ€§èƒ½æŒ‡æ ‡**ï¼šæµ‹é‡å¤„ç†é€Ÿåº¦ã€æ•°æ®é‡ç­‰æ€§èƒ½å‚æ•°

### ğŸ“ æ—¥å¿—è®°å½•
- **åˆ†ç±»æ—¥å¿—**ï¼šåŸå§‹æ•°æ®ã€ç»“æ„åˆ†æã€æ€§èƒ½æŒ‡æ ‡åˆ†åˆ«è®°å½•
- **æ—¶é—´æˆ³**ï¼šç²¾ç¡®è®°å½•æ¯ä¸ªæ•°æ®å—çš„æ—¶é—´ä¿¡æ¯
- **æ€»ç»“æŠ¥å‘Š**ï¼šç”ŸæˆJSONæ ¼å¼çš„æµ‹è¯•æ€»ç»“

## ä½¿ç”¨æ–¹æ³•

### 1. å¿«é€Ÿæµ‹è¯•
```bash
cd agent-mi/travel
python test_stream_data_logger.py --mode quick
```

### 2. å•ä¸ªæµ‹è¯•
```bash
python test_stream_data_logger.py --mode single --input "æ¨èåŒ—äº¬æ™¯ç‚¹" --name "beijing_test"
```

### 3. æ‰¹é‡æµ‹è¯•
```bash
python test_stream_data_logger.py --mode batch
```

### 4. åœ¨ä»£ç ä¸­ä½¿ç”¨
```python
from test_stream_data_logger import test_stream_api_with_logging

# è¿è¡Œå•ä¸ªæµ‹è¯•
summary = test_stream_api_with_logging(
    user_input="æˆ‘æƒ³å»æ­å·æ—…æ¸¸3å¤©",
    test_name="hangzhou_test"
)

print(f"æ€»æ•°æ®å—æ•°: {summary['data_statistics']['total_chunks']}")
```

## è¾“å‡ºæ–‡ä»¶è¯´æ˜

æµ‹è¯•å®Œæˆåï¼Œä¼šåœ¨ `stream_test_logs/` ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### ğŸ“ å•ä¸ªæµ‹è¯•ç›®å½•ç»“æ„
```
stream_test_logs/
â””â”€â”€ test_name_20250716_170000/
    â”œâ”€â”€ raw_stream_data_20250716_170000.log      # åŸå§‹æ•°æ®æ—¥å¿—
    â”œâ”€â”€ data_structure_20250716_170000.log       # æ•°æ®ç»“æ„åˆ†æ
    â”œâ”€â”€ performance_metrics_20250716_170000.log  # æ€§èƒ½æŒ‡æ ‡
    â”œâ”€â”€ error_log_20250716_170000.log           # é”™è¯¯æ—¥å¿—
    â””â”€â”€ test_summary_20250716_170000.json       # æµ‹è¯•æ€»ç»“
```

### ğŸ“„ æ–‡ä»¶å†…å®¹è¯´æ˜

#### 1. åŸå§‹æ•°æ®æ—¥å¿— (raw_stream_data_*.log)
```
--- CHUNK #1 ---
æ—¶é—´æˆ³: 2025-07-16T17:00:01.123456
æ•°æ®å¤§å°: 1024 bytes
åŸå§‹æ•°æ®:
{
  "stream_mode": "updates",
  "chunk": {...},
  "processed": true
}
---
```

#### 2. æ•°æ®ç»“æ„åˆ†æ (data_structure_*.log)
```
--- ç»“æ„åˆ†æ #1 ---
æ—¶é—´æˆ³: 2025-07-16T17:00:01.123456
æ•°æ®ç±»å‹: dict
å­—æ®µç»“æ„: {
  "type": "dict",
  "keys": ["stream_mode", "chunk", "processed"],
  "fields": {...}
}
---
```

#### 3. æ€§èƒ½æŒ‡æ ‡ (performance_metrics_*.log)
```
æ—¶é—´æˆ³: 2025-07-16T17:00:01.123456
Chunk #1
å½“å‰å—å¤§å°: 1024 bytes
ç´¯è®¡æ•°æ®é‡: 1024 bytes
å¹³å‡å—å¤§å°: 1024.00 bytes
ç´¯è®¡è€—æ—¶: 0.123 seconds
å¤„ç†é€Ÿç‡: 8.13 chunks/sec
æ•°æ®é€Ÿç‡: 8325.20 bytes/sec
---
```

#### 4. æµ‹è¯•æ€»ç»“ (test_summary_*.json)
```json
{
  "test_info": {
    "start_time": "2025-07-16T17:00:00.000000",
    "end_time": "2025-07-16T17:00:30.000000",
    "total_duration_seconds": 30.0
  },
  "data_statistics": {
    "total_chunks": 25,
    "total_data_size_bytes": 25600,
    "average_chunk_size_bytes": 1024.0,
    "processing_rate_chunks_per_sec": 0.83,
    "data_rate_bytes_per_sec": 853.33
  },
  "structure_analysis": {
    "data_types_seen": ["dict"],
    "field_statistics": {
      "stream_mode": {
        "occurrence_count": 25,
        "data_types": ["str"]
      }
    }
  },
  "config_used": {
    "verbose_level": 1,
    "show_tokens": true,
    "show_progress": true,
    "show_timing": true
  }
}
```

## é…ç½®å‚æ•°

æµ‹è¯•ä½¿ç”¨çš„é…ç½®å‚æ•°æ¥è‡ª `simple_multi_turn_system/config.py` ä¸­çš„ `SUPERVISOR_CONFIG`ï¼š

```python
SUPERVISOR_CONFIG = {
    'verbose_level': 1,
    'show_tokens': True,
    'show_progress': True,
    'show_timing': True
}
```

## é¢„è®¾æµ‹è¯•ç”¨ä¾‹

æ‰¹é‡æµ‹è¯•æ¨¡å¼åŒ…å«ä»¥ä¸‹é¢„è®¾ç”¨ä¾‹ï¼š

1. **ç®€å•æŸ¥è¯¢** (`simple_query`)
   - è¾“å…¥ï¼š`"æ¨èåŒ—äº¬çš„æ™¯ç‚¹"`
   - ç›®çš„ï¼šæµ‹è¯•åŸºç¡€æ™¯ç‚¹æ¨èåŠŸèƒ½

2. **å¤æ‚è§„åˆ’** (`complex_planning`)
   - è¾“å…¥ï¼š`"æˆ‘æƒ³è¦ä¸€ä¸ª3å¤©çš„åŒ—äº¬æ—…æ¸¸è®¡åˆ’ï¼ŒåŒ…æ‹¬æ•…å®«ã€å¤©å›ã€é¢å’Œå›­"`
   - ç›®çš„ï¼šæµ‹è¯•å¤æ‚è¡Œç¨‹è§„åˆ’åŠŸèƒ½

3. **è¯¦ç»†éœ€æ±‚** (`detailed_request`)
   - è¾“å…¥ï¼š`"æˆ‘å’Œå¥³æœ‹å‹è®¡åˆ’ä¸‹ä¸ªæœˆå»æ­å·ç©3å¤©ï¼Œé¢„ç®—3000å…ƒï¼Œå–œæ¬¢å†å²æ–‡åŒ–å’Œç¾é£Ÿï¼Œè¯·å¸®æˆ‘åˆ¶å®šè¯¦ç»†çš„æ—…æ¸¸è®¡åˆ’"`
   - ç›®çš„ï¼šæµ‹è¯•è¯¦ç»†éœ€æ±‚å¤„ç†èƒ½åŠ›

## æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒä¾èµ–**ï¼šç¡®ä¿æ‰€æœ‰ç›¸å…³æ¨¡å—éƒ½å·²æ­£ç¡®å®‰è£…å’Œé…ç½®
2. **ç½‘ç»œè¿æ¥**ï¼šæµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦è®¿é—®å¤–éƒ¨APIï¼Œç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
3. **å­˜å‚¨ç©ºé—´**ï¼šæ—¥å¿—æ–‡ä»¶å¯èƒ½è¾ƒå¤§ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
4. **æµ‹è¯•æ—¶é—´**ï¼šå¤æ‚æµ‹è¯•å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥æ¨¡å—å¤±è´¥**
   ```
   ImportError: No module named 'enhanced_stream_api_V1'
   ```
   - è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæ¨¡å—ä¾èµ–

2. **Supervisoråˆå§‹åŒ–å¤±è´¥**
   ```
   Error: æ— æ³•åˆ›å»ºsupervisor
   ```
   - è§£å†³ï¼šæ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥

3. **æ—¥å¿—æ–‡ä»¶æƒé™é”™è¯¯**
   ```
   PermissionError: [Errno 13] Permission denied
   ```
   - è§£å†³ï¼šæ£€æŸ¥ç›®å½•å†™å…¥æƒé™

### è°ƒè¯•æ¨¡å¼

å¦‚éœ€æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼š

```python
logging.basicConfig(level=logging.DEBUG)
```

## æ•°æ®åˆ†æå»ºè®®

åŸºäºæµ‹è¯•ç»“æœï¼Œæ‚¨å¯ä»¥åˆ†æä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š

1. **æ•°æ®å—é¢‘ç‡**ï¼šäº†è§£æµå¼è¾“å‡ºçš„æ—¶é—´ç‰¹å¾
2. **æ•°æ®ç»“æ„ç¨³å®šæ€§**ï¼šæ£€æŸ¥å­—æ®µç»“æ„çš„ä¸€è‡´æ€§
3. **æ€§èƒ½ç“¶é¢ˆ**ï¼šè¯†åˆ«å¤„ç†é€Ÿåº¦çš„é™åˆ¶å› ç´ 
4. **æ•°æ®é‡åˆ†å¸ƒ**ï¼šäº†è§£ä¸åŒç±»å‹æŸ¥è¯¢çš„æ•°æ®é‡å·®å¼‚

è¿™äº›åˆ†æç»“æœå°†ä¸ºæ‚¨çš„æµå¼APIå°è£…æä¾›é‡è¦çš„è®¾è®¡å‚è€ƒã€‚
