/**
 * æœç´¢å†…å®¹è§£æå™¨æµ‹è¯•æ–‡ä»¶
 * ç”¨äºæµ‹è¯•å’ŒéªŒè¯æœç´¢å·¥å…·å†…å®¹çš„è§£æåŠŸèƒ½
 */

import SearchContentParser from './searchContentParser.js'
import ContentFormatter from './contentFormatter.js'

// æµ‹è¯•æ•°æ® - æ‚¨æä¾›çš„æœç´¢å·¥å…·è¿”å›å†…å®¹
const testSearchContent = `{'type': 'search_ref', 'datas': [{'title': '2025 å¹´æ–°ç–†ä¸ƒå¤©æ¸¸éœ€è¦å¤šå°‘?å—ç–†7æ—¥çº¯ç©è€å¹´å›¢æ—…æ¸¸å®‰æ’æ¨è!', 'url': 'https://baijiahao.baidu.com/s?id=1837177177261357963&wfr=spider&for=pc', 'content': ' Day1:æŠµè¾¾ä¹Œé²æœ¨é½ æˆ‘ä»¬æŠµè¾¾ä¹Œé²æœ¨é½å,å°ç‰æ—©å·²åœ¨æœºåœºç­‰å€™,çƒ­æƒ…åœ°è¿æ¥æˆ‘ä»¬,å¸®å¿™æ‹¿è¡Œæ,å®‰æ’æˆ‘ä»¬å‰å¾€é…’åº—ã€‚ç¨ä½œä¼‘æ¯,æ™šä¸Šä¾¿å¸¦æˆ‘ä»¬å»å“å°åœ°é“çš„æ–°ç–†ç¾é£Ÿ,å¤§ç›˜é¸¡ã€çƒ¤åŒ…å­,é‚£æ»‹å‘³,è‡³ä»Šæƒ³èµ·æ¥éƒ½è®©äººå‚æ¶ã€‚ Day2:ä¹Œé²æœ¨é½ - åº“å°”å‹’ ä¹˜åèˆ’é€‚çš„äº¤é€šå·¥å…·å‰å¾€åº“å°”å‹’,ä¸€è·¯ä¸Š,å¹¿è¢¤çš„æ–°ç–†é£å…‰ä»¤äººç›®ä¸æš‡æ¥,è¿œå¤„å±±è„‰è¿ç»µ,æˆˆå£æ»©ä¸€æœ›æ— é™…,å¶å°”è¿˜èƒ½çœ‹åˆ°æˆç¾¤çš„ç‰›ç¾Š,å°½æ˜¾æ–°ç–†çš„å£®ç¾è¾½é˜”ã€‚æŠµè¾¾åº“å°”å‹’å,æ¼«æ­¥è¡—å¤´,æ„Ÿå—è¿™åº§åŸå¸‚çš„çƒ­é—¹ä¸çƒŸç«æ°”,å“å°çƒ¤ç¾Šè‚‰ä¸²ã€é¦•å‘è‚‰ç­‰ç¾é£Ÿã€‚ Day3:åº“å°”å‹’ - ç½—å¸ƒäººæ‘å¯¨ æ—©é¤åå‰å¾€ç¥ç§˜çš„ç½—å¸ƒäººæ‘å¯¨ã€‚æ‘å¯¨å‘¨è¾¹é£æ™¯ç‹¬ç‰¹,å¡”é‡Œæœ¨æ²³èœ¿èœ’ç©¿è¿‡,ä¸¤å²¸èƒ¡æ¨æ—èŒ‚å¯†,èƒŒåæ˜¯æµ©ç€šçš„å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ ã€‚è¿›å…¥æ‘å¯¨,å¤è€çš„ç½—å¸ƒäººæ°‘å±…ç”¨èƒ¡æ¨æœ¨å’ŒèŠ¦è‹‡æ­å»ºè€Œæˆ,å……æ»¡åŸå§‹æ°”æ¯ã€‚åœ¨è¿™é‡Œ,æˆ‘ä»¬æ·±å…¥äº†è§£äº†ç½—å¸ƒäººçš„ç‹¬ç‰¹æ–‡åŒ–å’Œç”Ÿæ´»æ–¹å¼ã€‚æ²¿ç€å¡”é‡Œæœ¨æ²³æ¼«æ­¥,æ¬£èµé‡‘é»„çš„èƒ¡æ¨æ—,è¿˜ä½“éªŒäº†åˆºæ¿€çš„æ²™æ¼ è¶Šé‡è½¦å’Œæ‚ æ‰¬çš„éª†é©¼éª‘è¡Œ,å‚æ™šçš„æ²™æ¼ æ—¥è½æ›´æ˜¯ç¾åˆ°ä»¤äººçª’æ¯ã€‚ Day4:ç½—å¸ƒäººæ‘å¯¨ - å¡”é‡Œæœ¨èƒ¡æ¨æ— æ¸…æ™¨å†æ¬¡æ„Ÿå—ç½—å¸ƒäººæ‘å¯¨çš„å®é™,ä¹‹åå‰å¾€å¡”é‡Œæœ¨èƒ¡æ¨æ—ã€‚ä¹˜åè§‚å…‰å°ç«è½¦æ·±å…¥èƒ¡æ¨æ—,ä»¿ä½›ç½®èº«é‡‘è‰²æµ·æ´‹ã€‚è¿™é‡Œçš„èƒ¡æ¨å½¢æ€å„å¼‚,æœ‰çš„é«˜å¤§æŒºæ‹”,æœ‰çš„æå¹²æ‰­æ›²,å®ƒä»¬è€æ—±ã€è€ç›ç¢±ã€æŠ—é£æ²™,"ç”Ÿè€Œåƒå¹´ä¸æ­»,æ­»è€Œåƒå¹´ä¸å€’,å€’è€Œåƒå¹´ä¸æœ½",ä»¤äººè‚ƒç„¶èµ·æ•¬ã€‚ Day5:å¡”é‡Œæœ¨èƒ¡æ¨æ— - åº“è½¦ é€”ä¸­æ¬£èµå—ç–†ç”°å›­é£å…‰,æŠµè¾¾åº“è½¦åæ¸¸è§ˆåº“è½¦ç‹åºœ,èåˆä¸­åŸå’Œç»´å¾å°”æ—å»ºç­‘é£æ ¼,æ°”åŠ¿æ¢å®,è¿˜èƒ½äº†è§£åº“è½¦ç‹å®¶æ—å†å²å˜è¿ã€‚å‚æ™šåœ¨åº“è½¦å¤œå¸‚å“å°ç‰¹è‰²ç¾é£Ÿ,è´­ä¹°ç²¾ç¾çºªå¿µå“ã€‚ Day6:åº“è½¦ - å¤©å±±ç¥ç§˜å¤§å³¡è°· - å–€ä»€ å‰å¾€å¤©å±±ç¥ç§˜å¤§å³¡è°·,çº¢è¤è‰²å±±ä½“ç¾¤ç»„æˆçš„å³¡è°·æ›²å¾„é€šå¹½,å³°å›è·¯è½¬,è¿˜æœ‰å¤è€ä½›æ•™çŸ³çªŸã€‚ä¹‹åå‰å¾€å–€ä»€,è¿™åº§å…·æœ‰ä¸¤åƒå¤šå¹´å†å²çš„å¤åŸ,å……æ»¡æµ“éƒç»´å¾å°”æ—é£æƒ…,å¤œæ™šæ¼«æ­¥å¤åŸè¡—å¤´,å“å°ç¾é£Ÿ,æ„Ÿå—ç‹¬ç‰¹é­…åŠ›ã€‚', 'siteName': '', 'pic': None}, {'title': 'æ–°ç–†å—ç–†æ—…æ¸¸å¿…å»çš„åå¤§æ™¯ç‚¹:æ¢ç´¢ç¥ç§˜è¥¿åŸŸçš„ç»ç¾é£å…‰', 'url': 'https://baijiahao.baidu.com/s?id=1837532649561249115&wfr=spider&for=pc', 'content': ' ä¸€ã€å–€ä»€å¤åŸâ€”â€”æ´»ç€çš„åƒå¹´è¥¿åŸŸé£æƒ… ä½œä¸ºå—ç–†æœ€å…·ä»£è¡¨æ€§çš„æ—…æ¸¸ç›®çš„åœ°,å–€ä»€å¤åŸæ˜¯æ–°ç–†å”¯ä¸€ä¸€åº§ä»¥ä¼Šæ–¯å…°æ–‡åŒ–ä¸ºç‰¹è‰²çš„è¿·å®«å¼åŸå¸‚è¡—åŒº,ä¹Ÿæ˜¯ä¸–ç•Œä¸Šç°å­˜è§„æ¨¡æœ€å¤§çš„ç”ŸåœŸå»ºç­‘ç¾¤ä¹‹ä¸€ã€‚æ¼«æ­¥åœ¨å–€ä»€å¤åŸçš„è¡—å··ä¸­,ä»¿ä½›ç©¿è¶Šå›äº†åƒå¹´å‰çš„è¥¿åŸŸã€‚ å¤åŸå†…æœ€å€¼å¾—ä¸€çœ‹çš„æ˜¯è‰¾æå°•å°”æ¸…çœŸå¯º,è¿™æ˜¯æ–°ç–†æœ€å¤§çš„æ¸…çœŸå¯º,æ¯é€¢å¤å°”é‚¦èŠ‚,è¿™é‡Œä¼šèšé›†æ•°ä¸‡ç©†æ–¯æ—è¿›è¡Œç¤¼æ‹œ,åœºé¢æä¸ºå£®è§‚ã€‚æ­¤å¤–,ç™¾å¹´è€èŒ¶é¦†ä¹Ÿæ˜¯ä½“éªŒå½“åœ°ç”Ÿæ´»çš„å¥½å»å¤„,ç‚¹ä¸€å£¶ç –èŒ¶,é…ä¸Šä¸€å—é¦•,çœ‹ç€è¡—ä¸Šæ¥å¾€çš„ç»´å¾å°”æ—è€äºº,æ—¶å…‰ä»¿ä½›åœ¨æ­¤åœæ»ã€‚ æ—…æ¸¸å°è´´å£«:å–€ä»€å¤åŸæœ€ä½³æ¸¸è§ˆæ—¶é—´æ˜¯æ¸…æ™¨æˆ–å‚æ™š,æ­¤æ—¶å…‰çº¿æŸ”å’Œ,æ¸¸å®¢è¾ƒå°‘ã€‚è®°å¾—ç©¿èˆ’é€‚çš„é‹å­,å¤åŸå†…å¤šä¸ºçŸ³æ¿è·¯å’ŒåœŸè·¯ã€‚ äºŒã€å¸•ç±³å°”é«˜åŸâ€”â€”ä¸–ç•Œå±‹è„Šä¸Šçš„å£®ç¾é£å…‰ å¸•ç±³å°”é«˜åŸè¢«èª‰ä¸º"ä¸–ç•Œå±‹è„Š",å¹³å‡æµ·æ‹”4000ç±³ä»¥ä¸Š,æ˜¯è¿æ¥ä¸­äºšå’Œå—äºšçš„å¤©ç„¶å±éšœã€‚è¿™é‡Œçš„æ…•å£«å¡”æ ¼å³°(æµ·æ‹”7546ç±³)å’Œå…¬æ ¼å°”ä¹åˆ«å³°æ„æˆäº†å£®ä¸½çš„é›ªå±±æ™¯è§‚,è¢«ç§°ä¸º"å†°å±±ä¹‹çˆ¶"ã€‚ é«˜åŸä¸Šçš„å¡æ‹‰åº“é‡Œæ¹–æ˜¯å¿…å»æ™¯ç‚¹,æ¹–æ°´éšå…‰çº¿å˜åŒ–å‘ˆç°è“ã€ç»¿ã€é»‘ç­‰ä¸åŒé¢œè‰²,å€’æ˜ ç€é›ªå±±,æ™¯è‰²ä»¤äººéœ‡æ’¼ã€‚å¡”ä»€åº“å°”å¹²å¿æ˜¯ä¸­å›½å”¯ä¸€çš„å¡”å‰å…‹æ—è‡ªæ²»å¿,è¿™é‡Œçš„çŸ³å¤´åŸé—å€å’Œçº¢å…¶æ‹‰ç”«å£å²¸ä¹Ÿå€¼å¾—ä¸€æ¸¸ã€‚ é«˜åŸååº”é¢„é˜²:å¸•ç±³å°”é«˜åŸæµ·æ‹”é«˜,å»ºè®®æå‰åœ¨å–€ä»€é€‚åº”1-2å¤©,å‡†å¤‡æŠ—é«˜åè¯ç‰©,è¡ŒåŠ¨è¦ç¼“æ…¢,é¿å…å‰§çƒˆè¿åŠ¨ã€‚ ä¸‰ã€å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ â€”â€”æ­»äº¡ä¹‹æµ·çš„å¥‡å¹»ä¹‹æ—… ä½œä¸ºä¸–ç•Œç¬¬äºŒå¤§æµåŠ¨æ²™æ¼ ,å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ å æ®äº†å—ç–†å¤§éƒ¨åˆ†åœ°åŒº,ç»´å¾å°”è¯­æ„ä¸º"è¿›å»å‡ºä¸æ¥"ã€‚æ²™æ¼ ä¸­çš„èƒ¡æ¨æ—æ˜¯æœ€å…·ç‰¹è‰²çš„æ™¯è§‚,ç‰¹åˆ«æ˜¯ç§‹å­£,é‡‘é»„çš„èƒ¡æ¨ä¸è“å¤©æ²™æ¼ å½¢æˆå¼ºçƒˆå¯¹æ¯”ã€‚ æ²™æ¼ å…¬è·¯æ˜¯ä¸–ç•Œæœ€é•¿çš„è´¯ç©¿æµåŠ¨æ²™æ¼ çš„ç­‰çº§å…¬è·¯,æ²¿é€”å¯æ¬£èµå£®è§‚çš„æ²™ä¸˜æ™¯è§‚ã€‚éº¦ç›–æå¿çš„N39Â°æ²™æ¼ æ¢é™©åŸºåœ°æ˜¯ä½“éªŒæ²™æ¼ éœ²è¥ã€éª‘éª†é©¼çš„å¥½å»å¤„ã€‚ æœ€ä½³æ—…è¡Œæ—¶é—´:10æœˆä¸‹æ—¬è‡³11æœˆä¸Šæ—¬æ˜¯è§‚èµèƒ¡æ¨çš„æœ€ä½³å­£èŠ‚,æ­¤æ—¶æ°”æ¸©é€‚å®œ,èƒ¡æ¨å¶å­é‡‘é»„ã€‚å¤å­£æ²™æ¼ æ¸©åº¦æé«˜,ä¸å»ºè®®æ­¤æ—¶å‰å¾€ã€‚ å››ã€å¤©å±±ç¥ç§˜å¤§å³¡è°·â€”â€”çº¢è‰²å±±å²©çš„è§†è§‰ç››å®´ ä½äºåº“è½¦å¿åŒ—éƒ¨çš„å¤©å±±ç¥ç§˜å¤§å³¡è°·ç”±çº¢è‰²ç ‚å²©æ„æˆ,ç»è¿‡äº¿ä¸‡å¹´çš„é£èš€æ°´åˆ‡,å½¢æˆäº†åƒå§¿ç™¾æ€çš„å¥‡ç‰¹åœ°è²Œã€‚å³¡è°·å…¨é•¿çº¦5å…¬é‡Œ,æœ€çª„å¤„ä»…å®¹ä¸€äººä¾§èº«é€šè¿‡ã€‚ å³¡è°·å†…çš„é˜¿è‰¾çŸ³çªŸä¿å­˜æœ‰ç²¾ç¾çš„ä½›æ•™å£ç”»,è§è¯äº†å¤é¾Ÿå…¹å›½çš„ä½›æ•™æ–‡åŒ–ã€‚å¤•é˜³è¥¿ä¸‹æ—¶,æ•´ä¸ªå³¡è°·è¢«æŸ“æˆé‡‘çº¢è‰²,æ™¯è‰²å°¤ä¸ºå£®è§‚ã€‚ æ‘„å½±å»ºè®®:å³¡è°·å†…å…‰çº¿å˜åŒ–å¤§,', 'siteName': '', 'pic': None}]}`

class SearchParserTester {
  /**
   * è¿è¡Œæ‰€æœ‰æµ‹è¯•
   */
  static runAllTests() {
    console.log('ğŸ§ª å¼€å§‹æœç´¢å†…å®¹è§£æå™¨æµ‹è¯•...\n')
    
    this.testBasicParsing()
    this.testContentFormatting()
    this.testErrorHandling()
    this.testPerformance()
    
    console.log('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ!')
  }

  /**
   * æµ‹è¯•åŸºç¡€è§£æåŠŸèƒ½
   */
  static testBasicParsing() {
    console.log('ğŸ“‹ æµ‹è¯•1: åŸºç¡€è§£æåŠŸèƒ½')
    
    try {
      const parsed = SearchContentParser.parseSearchContent(testSearchContent)
      
      console.log('âœ“ è§£ææˆåŠŸ')
      console.log(`âœ“ æ•°æ®ç±»å‹: ${parsed.type}`)
      console.log(`âœ“ æœç´¢ç»“æœæ•°é‡: ${parsed.results.length}`)
      console.log(`âœ“ æ€»ç»“æœæ•°: ${parsed.metadata.totalResults}`)
      
      // æ£€æŸ¥ç¬¬ä¸€ä¸ªç»“æœçš„ç»“æ„
      if (parsed.results.length > 0) {
        const firstResult = parsed.results[0]
        console.log(`âœ“ ç¬¬ä¸€ä¸ªç»“æœæ ‡é¢˜: ${firstResult.title.substring(0, 30)}...`)
        console.log(`âœ“ ç¬¬ä¸€ä¸ªç»“æœæ‘˜è¦: ${firstResult.summary.substring(0, 50)}...`)
        console.log(`âœ“ ç›¸å…³æ€§åˆ†æ•°: ${firstResult.relevanceScore}`)
      }
      
      console.log('')
    } catch (error) {
      console.error('âŒ åŸºç¡€è§£ææµ‹è¯•å¤±è´¥:', error)
    }
  }

  /**
   * æµ‹è¯•å†…å®¹æ ¼å¼åŒ–åŠŸèƒ½
   */
  static testContentFormatting() {
    console.log('ğŸ¨ æµ‹è¯•2: å†…å®¹æ ¼å¼åŒ–åŠŸèƒ½')
    
    try {
      const formattedHtml = ContentFormatter.formatToolContent(testSearchContent, {
        showSummary: true,
        showMetadata: true,
        maxResults: 5,
        cardStyle: true
      })
      
      console.log('âœ“ HTMLæ ¼å¼åŒ–æˆåŠŸ')
      console.log(`âœ“ ç”ŸæˆHTMLé•¿åº¦: ${formattedHtml.length} å­—ç¬¦`)
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«å…³é”®å…ƒç´ 
      const hasSearchContainer = formattedHtml.includes('search-results-container')
      const hasSearchTitle = formattedHtml.includes('search-results-title')
      const hasSearchItems = formattedHtml.includes('search-item')
      
      console.log(`âœ“ åŒ…å«æœç´¢å®¹å™¨: ${hasSearchContainer}`)
      console.log(`âœ“ åŒ…å«æœç´¢æ ‡é¢˜: ${hasSearchTitle}`)
      console.log(`âœ“ åŒ…å«æœç´¢é¡¹ç›®: ${hasSearchItems}`)
      
      console.log('')
    } catch (error) {
      console.error('âŒ å†…å®¹æ ¼å¼åŒ–æµ‹è¯•å¤±è´¥:', error)
    }
  }

  /**
   * æµ‹è¯•é”™è¯¯å¤„ç†
   */
  static testErrorHandling() {
    console.log('ğŸ›¡ï¸ æµ‹è¯•3: é”™è¯¯å¤„ç†')
    
    // æµ‹è¯•æ— æ•ˆè¾“å…¥
    const invalidInputs = [
      null,
      undefined,
      '',
      'invalid json',
      '{"invalid": "structure"}',
      '{"type": "unknown", "data": []}'
    ]
    
    invalidInputs.forEach((input, index) => {
      try {
        const result = SearchContentParser.parseSearchContent(input)
        console.log(`âœ“ æ— æ•ˆè¾“å…¥ ${index + 1} å¤„ç†æ­£ç¡®: ${result === null ? 'null' : 'æœ‰ç»“æœ'}`)
      } catch (error) {
        console.log(`âœ“ æ— æ•ˆè¾“å…¥ ${index + 1} é”™è¯¯å¤„ç†æ­£ç¡®: ${error.message}`)
      }
    })
    
    console.log('')
  }

  /**
   * æµ‹è¯•æ€§èƒ½
   */
  static testPerformance() {
    console.log('âš¡ æµ‹è¯•4: æ€§èƒ½æµ‹è¯•')
    
    const iterations = 100
    const startTime = performance.now()
    
    for (let i = 0; i < iterations; i++) {
      SearchContentParser.parseSearchContent(testSearchContent)
    }
    
    const endTime = performance.now()
    const totalTime = endTime - startTime
    const avgTime = totalTime / iterations
    
    console.log(`âœ“ ${iterations} æ¬¡è§£ææ€»è€—æ—¶: ${totalTime.toFixed(2)}ms`)
    console.log(`âœ“ å¹³å‡æ¯æ¬¡è§£æè€—æ—¶: ${avgTime.toFixed(2)}ms`)
    console.log(`âœ“ æ¯ç§’å¯å¤„ç†: ${Math.round(1000 / avgTime)} æ¬¡`)
    
    console.log('')
  }

  /**
   * æµ‹è¯•æ–‡æœ¬æ‘˜è¦åŠŸèƒ½
   */
  static testTextSummary() {
    console.log('ğŸ“ æµ‹è¯•5: æ–‡æœ¬æ‘˜è¦åŠŸèƒ½')
    
    try {
      const parsed = SearchContentParser.parseSearchContent(testSearchContent)
      const textSummary = SearchContentParser.getTextSummary(parsed, 3)
      
      console.log('âœ“ æ–‡æœ¬æ‘˜è¦ç”ŸæˆæˆåŠŸ')
      console.log('æ‘˜è¦å†…å®¹:')
      console.log(textSummary)
      console.log('')
    } catch (error) {
      console.error('âŒ æ–‡æœ¬æ‘˜è¦æµ‹è¯•å¤±è´¥:', error)
    }
  }

  /**
   * æµ‹è¯•å†…å®¹ç»Ÿè®¡åŠŸèƒ½
   */
  static testContentStats() {
    console.log('ğŸ“Š æµ‹è¯•6: å†…å®¹ç»Ÿè®¡åŠŸèƒ½')
    
    try {
      const stats = ContentFormatter.getContentStats(testSearchContent)
      
      console.log('âœ“ å†…å®¹ç»Ÿè®¡ç”ŸæˆæˆåŠŸ')
      console.log(`âœ“ å†…å®¹ç±»å‹: ${stats.type}`)
      console.log(`âœ“ å†…å®¹é•¿åº¦: ${stats.length} å­—ç¬¦`)
      console.log(`âœ“ å•è¯æ•°é‡: ${stats.words}`)
      console.log(`âœ“ è¡Œæ•°: ${stats.lines}`)
      console.log(`âœ“ æ˜¯å¦ç»“æ„åŒ–æ•°æ®: ${stats.hasStructuredData}`)
      
      if (stats.searchResults) {
        console.log(`âœ“ æœç´¢ç»“æœæ•°é‡: ${stats.searchResults}`)
      }
      
      console.log('')
    } catch (error) {
      console.error('âŒ å†…å®¹ç»Ÿè®¡æµ‹è¯•å¤±è´¥:', error)
    }
  }
}

// å¯¼å‡ºæµ‹è¯•ç±»
export default SearchParserTester

// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ç›´æ¥è¿è¡Œ
if (typeof window !== 'undefined') {
  window.SearchParserTester = SearchParserTester
}
