# 百度法行宝接口集成说明（更新版）

## 概述

本项目已成功集成百度法行宝的AI对话接口，支持多种消息类型的流式响应和会话管理。

## 接口信息

- **接口地址**: `https://ailegal.baidu.com/dialog/openapi/aiAgent`
- **请求方法**: POST
- **响应格式**: SSE (Server-Sent Events) 流式返回

## 请求参数

| 字段 | 类型 | 说明 | 是否必须 |
|------|------|------|----------|
| key | string | openapi分配的key，固定字符串 | 是 |
| query | string | 用户输入的问题 | 是 |
| sessionID | string | 会话id，首次对话传空，openapi会返回一个新的sessionID | 否 |
| model | int | 模式配置，默认值为0 | 否 |
| history | []string | 需要携带的历史对话 | 否 |

### Model模式说明

- `0000000`：纯回复
- `0000001`：出律师卡
- `0000010`：出计算器卡片
- `0000100`：出意见书卡片
- `0001000`：出文书卡片
- `0010000`：回复中带法规
- `0100000`：回复中带类案
- `1000000`：可回复澄清追问

当前配置使用 `127` (1111111)，启用所有模式。

## 响应消息类型处理

### 支持的消息类型

| messageType | 类型 | 说明 | 处理方式 |
|-------------|------|------|----------|
| 1 | 法律咨询 | 基础法律咨询答案 | 直接显示富文本内容 |
| 9 | 法律咨询（带法规标） | 带法规标注的法律咨询 | 显示内容 + 扩展信息 |
| 26 | 相关法律查询 | 法规条款查询结果 | 格式化显示法规信息 |
| 19 | 微服务卡片 | 对话召回的服务卡片 | 显示卡片名称和描述 |
| 27 | 澄清追问 | 需要用户澄清的问题 | 显示追问内容和选项 |

### 消息类型详细说明

#### 1. 法律咨询 (messageType: 1, 9)
- **处理方式**: 直接显示content字段的富文本内容
- **扩展信息**: 对于type 9，还会显示ext字段的法规标注信息

#### 2. 相关法律查询 (messageType: 26)
- **数据结构**: 包含法规标题、条款信息、详细内容等
- **显示格式**: 
  - 使用Markdown格式美化显示
  - 分层显示法规标题、条款、内容
  - 包含法规的基本信息（性质、时效性、发布机构等）

#### 3. 微服务卡片 (messageType: 19)
- **数据结构**: 包含卡片名称、描述、链接等
- **显示格式**: 以卡片形式展示服务信息

#### 4. 澄清追问 (messageType: 27)
- **数据结构**: 包含追问内容和选项列表
- **显示格式**: 清晰显示追问内容和可选择的选项

## 配置说明

### API配置

在使用前，需要在代码中配置API Key：

1. 打开 `src/views/BaiduFaXingBaoView.vue` 文件
2. 找到 `BAIDU_API_KEY` 变量
3. 将 `'your_actual_api_key_here'` 替换为实际的API Key

```javascript
const BAIDU_API_KEY = 'your_actual_api_key_here'; // 替换为实际的API key
```

## 功能特性

### 1. 多类型消息处理
- 支持5种不同的消息类型
- 每种类型都有专门的格式化处理
- 自动识别消息类型并应用相应的显示逻辑

### 2. 流式响应
- 支持实时显示AI回复内容
- 提供流畅的用户体验
- 支持长文本的逐步显示

### 3. 会话管理
- 自动管理sessionID
- 支持多轮对话
- 保持对话上下文

### 4. 历史记录
- 自动收集最近3轮对话作为历史记录
- 支持上下文关联
- 提升对话质量

### 5. 错误处理
- 完善的错误处理机制
- 用户友好的错误提示
- 自动重试机制

## 使用流程

1. **配置API Key**:
   - 在代码中设置正确的API Key
   - 重新部署应用

2. **开始对话**:
   - 直接输入问题即可开始对话
   - 系统会自动获取sessionID
   - 支持多轮对话

3. **查看结果**:
   - 根据问题类型，系统会返回不同类型的响应
   - 法律查询会显示格式化的法规信息
   - 澄清追问会显示选项供用户选择

## 技术实现

### 核心文件

- `src/views/BaiduFaXingBaoView.vue`: 主界面组件
- `src/utils/streamUtils.js`: 流式响应处理工具

### 关键功能

1. **消息类型识别**: 根据messageType字段自动识别消息类型
2. **格式化处理**: 每种消息类型都有专门的格式化逻辑
3. **SSE流式处理**: 使用 `handleStreamingResponse` 函数处理服务器发送事件
4. **会话管理**: 自动保存和复用sessionID
5. **错误恢复**: 完善的错误处理和用户提示

### 代码结构

```javascript
// 消息类型处理逻辑
switch (messageType) {
  case 1: // 法律咨询
  case 9: // 法律咨询（带法规标）
    // 处理基础法律咨询
    break;
    
  case 26: // 相关法律查询
    // 格式化法律查询结果
    break;
    
  case 19: // 微服务卡片
    // 显示服务卡片
    break;
    
  case 27: // 澄清追问
    // 显示追问内容和选项
    break;
    
  default:
    // 处理其他类型消息
    break;
}
```

## 注意事项

1. **API密钥安全**: 请妥善保管API密钥，不要泄露给他人
2. **网络要求**: 需要稳定的网络连接以支持流式响应
3. **浏览器兼容**: 建议使用现代浏览器以获得最佳体验
4. **会话限制**: 单个会话有最大对话轮次限制，请注意使用
5. **消息类型**: 不同的查询会返回不同类型的消息，系统会自动处理

## 故障排除

### 常见问题

1. **API请求失败**
   - 检查API Key是否正确
   - 确认网络连接正常
   - 验证接口地址是否可访问

2. **流式响应中断**
   - 检查网络稳定性
   - 刷新页面重试
   - 检查浏览器控制台错误信息

3. **消息显示异常**
   - 检查messageType是否正确识别
   - 查看控制台日志了解具体错误
   - 确认数据格式是否符合预期

### 调试信息

- 打开浏览器开发者工具
- 查看Console标签页的日志信息
- 检查Network标签页的请求详情
- 观察messageType的处理过程

## 更新日志

- **v1.0.0**: 初始版本，支持基本的对话功能
- **v1.1.0**: 简化配置，移除fr参数
- **v1.2.0**: 优化流式响应处理和错误处理
- **v1.3.0**: 新增多类型消息处理，支持5种不同的消息类型 